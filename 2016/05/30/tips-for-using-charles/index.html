<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 抓包工具 Charles 使用心得 · Tang's Blog</title><meta name="description" content="抓包工具 Charles 使用心得 - Tang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://imtangqi.com/atom.xml" title="Tang's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="http://weibo.com/qiktang" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/tangqi92" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">抓包工具 Charles 使用心得</h1><div class="post-info">May 30, 2016</div><div class="post-content"><h2 id="前言">前言</h2><p>虽然实习工作还没有着落，但学习还是要继续的嘛，今天就来学习使用下 Mac 下截取网络封包的工具：<a href="http://www.charlesproxy.com/" target="_blank" rel="external">Charles</a>。</p>
<p>我想，如果你是个善于利用搜索引擎的人，那么在 Google 中输入「Charles 使用」等相应的关键字，便会出现一大把文章。<br>不过呢，之所以会有这篇文章，就是因为今天在安装和初步使用的过程中，遇到了些问题，而目前搜索出来的绝大数文章并没有提及（或者解决办法已经过时）。所以，我在此记录下来，希望能帮助到通过搜索找到这的朋友们。</p>
<a id="more"></a>
<hr>
<h2 id="付费_&amp;_正版">付费 &amp; 正版</h2><blockquote>
<p>Charles 是收费软件，可以免费试用 30 天。试用期过后，未付费的用户仍然可以继续使用，但是每次使用时间不能超过 30 分钟，使用过程中不定时会中断 5 秒钟，并且启动时将会有 10 秒种的延时。因此，该付费方案对广大用户还是相当友好的，即使你长期不付费，也能使用完整的软件功能。只是当你需要长时间进行封包调试时，会因为 Charles 强制关闭而遇到影响。</p>
</blockquote>
<p>关于价格，见下表：</p>
<table>
<thead>
<tr>
<th>License</th>
<th style="text-align:center">Pricing</th>
</tr>
</thead>
<tbody>
<tr>
<td>1-4 User Licenses</td>
<td style="text-align:center">US$50 / license</td>
</tr>
<tr>
<td>5+ User Licenses</td>
<td style="text-align:center">US$40 / license (20% discount)</td>
</tr>
<tr>
<td>10+ User Licenses</td>
<td style="text-align:center">US$30 / license (40% discount)</td>
</tr>
<tr>
<td>Site License</td>
<td style="text-align:center">US$400</td>
</tr>
<tr>
<td>Multi-Site License</td>
<td style="text-align:center">US$700</td>
</tr>
</tbody>
</table>
<p>50 刀的价格虽然不白菜，但试用版并未阉割功能，只是在使用体验上稍差，这可称得上良心啊。虽然我暂时不会购买，但我依然会使用正版，希望你也如此。</p>
<hr>
<h2 id="VPN">VPN</h2><p>当我打开 Charles（Mac OS X Proxy 已选择），按理说，我立刻就能看见源源不断的网络请求出现在 Charles 的界面中啦，可为什么始终是一片空白呢？</p>
<p>一番搜索，终于在这里 <a href="http://stackoverflow.com/questions/25697849/charles-proxy-not-working-with-chrome" target="_blank" rel="external">Charles proxy not working with Chrome</a> 找到了答案：</p>
<blockquote>
<p>For anyone else using VPN: Charles must be turned on before VPN. So quitting VPN after turning on Charles won’t work either.</p>
</blockquote>
<p>没办法，为了正常使用 Charles，只能暂时把梯子撤了：</p>
<p><img src="http://7xikfc.com1.z0.glb.clouddn.com/tips-for-using-charles-01.png" alt=""></p>
<hr>
<h2 id="乱码">乱码</h2><p>刚开始用着挺好的啊，怎么一言不合，就来个乱码呢？</p>
<p><img src="http://7xikfc.com1.z0.glb.clouddn.com/tips-for-using-charles-08.png" alt=""></p>
<p>于是，便在 Google 中输入「Charles 乱码」，我保证，你能搜到的绝对是这样的答案：</p>
<p><img src="http://7xikfc.com1.z0.glb.clouddn.com/tips-for-using-charles-09.jpg" alt=""></p>
<p>可我告诉你，反正我尝试了在各种地方进行添加，最后都没有成功。<br>而我最终解决了乱码的问题，但根本没有涉及到 <code>Info.plist</code>。你只要确保，我接下来提及的问题，你有正确进行设置。</p>
<h3 id="安装_SSL_证书">安装 SSL 证书</h3><h4 id="Mac_端">Mac 端</h4><blockquote>
<p>首先去 <a href="http://www.charlesproxy.com/ssl.zip" target="_blank" rel="external">http://www.charlesproxy.com/ssl.zip</a> 下载 CA 证书文件，然后双击 .crt 文件，选择「总是信任」按钮，在钥匙串访问中即可看到添加成功的证书。</p>
</blockquote>
<p>看看，人家说的多么简单啊，可事实呢？当我访问上述网址时，出现的是如下的文字：</p>
<blockquote>
<p>If you are running Charles v3.10 or later, please go to Charles and consult the SSL Proxying submenu in the Help menu, for instructions on installing your new Charles Root Certificate.</p>
</blockquote>
<p>我那蹩脚的英文告诉我：如果你使用的是 v3.10 及之后的版本，安装方法已经变了，正确的姿势：启动 Charles 软件，在菜单中找到 Help -&gt; SSL Proxying -&gt; Install Charles Root Certificate. 如下图所示：</p>
<p><img src="http://7xikfc.com1.z0.glb.clouddn.com/tips-for-using-charles-02.png" alt=""><a href="http://blog.devtang.com/2015/11/14/charles-introduction/" target="_blank" rel="external">图片来自</a></p>
<p>随后是这样的：</p>
<p><img src="http://7xikfc.com1.z0.glb.clouddn.com/tips-for-using-charles-03.jpg" alt=""><br><img src="http://7xikfc.com1.z0.glb.clouddn.com/tips-for-using-charles-04.jpg" alt=""><a href="https://gitsea.com/2015/11/11/charles-https-%E6%8A%93%E5%8C%85-mac/" target="_blank" rel="external">图片来自</a></p>
<h4 id="iPhone_端">iPhone 端</h4><p>步骤：Help -&gt; SSL Proxying -&gt;Install Charles Root Certificate on a Mobile Device…</p>
<p><img src="http://7xikfc.com1.z0.glb.clouddn.com/tips-for-using-charles-07.png" alt=""></p>
<h3 id="Mac_上的设置">Mac 上的设置</h3><ol>
<li><p>在 Charles 的工具栏上点击设置按钮，选择 SSL Proxy Settings，选中 Enable SSL Proxying。（别急，选完先别关掉）</p>
</li>
<li><p>SSL 选项卡的 Locations 里填写要抓包的域名和端口，点击 Add 按钮，在弹出的表单中 Host 填写域名。比如填api.instagram.com，Port 填 443</p>
</li>
</ol>
<p><img src="http://7xikfc.com1.z0.glb.clouddn.com/tips-for-using-charles-11.jpg" alt=""><a href="https://gitsea.com/2015/11/11/charles-https-%E6%8A%93%E5%8C%85-mac/" target="_blank" rel="external">图片来自</a></p>
<p><strong>关于乱码，如果没有做这项操作，则肯定会出现乱码。而至于否是在 <code>Info.plist</code> 中添加 <code>UTF-8</code> 的字段，反正最后我没加，但一切正常。</strong></p>
<p>所以这个坑，我也是无意间解决的。</p>
<h3 id="iPhone_上的设置">iPhone 上的设置</h3><blockquote>
<p>首先我们需要获取 Charles 运行所在电脑的 IP 地址，Charles 的顶部菜单的 “Help”-&gt;”Local IP Address”，即可在弹出的对话框中看到 IP 地址，如下图所示：</p>
</blockquote>
<p><img src="http://7xikfc.com1.z0.glb.clouddn.com/tips-for-using-charles-05.png" alt=""></p>
<p>然后就是在 iPhone 上的一系列操作，又是很简单，有木有！</p>
<p>可是，为什么尼玛我怎么试都不成果呢？！iPhone 上浏览器网址都打不开了….于是又尝试了另一种方式，在终端敲入 <code>ifconfig en0</code>：</p>
<p><img src="http://7xikfc.com1.z0.glb.clouddn.com/tips-for-using-charles-06.jpg" alt=""><a href="http://zhangfei.tk/2016/02/18/%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7Charles%E7%9A%84%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/" target="_blank" rel="external">图片来自</a></p>
<p>Done! 终于可以愉快的玩耍了：）</p>
<hr>
<h2 id="参考">参考</h2></div></article></div></main><footer><div class="paginator"><a href="/2016/06/12/garbage-collection-in-java/" class="prev">上一篇</a><a href="/2016/05/20/the-notes-of-learning-afnetworking-seven/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'tangqi92githubio';
var disqus_identifier = '2016/05/30/tips-for-using-charles/';
var disqus_title = '抓包工具 Charles 使用心得';
var disqus_url = 'http://imtangqi.com/2016/05/30/tips-for-using-charles/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//tangqi92githubio.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2018 <a href="http://imtangqi.com">Tang</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-61827851-1",'auto');ga('send','pageview');</script></body></html>